<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">

    <head th:replace="~{common/head}"></head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" th:href="@{/img/favicon.png}" type="image/x-icon">
    <link rel="shortcut icon" th:href="@{/img/favicon.png}" type="image/x-icon">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link th:href="@{/css/home.css}" rel="stylesheet">
    <meta name="_csrf" th:content="${_csrf.token}" />

    <link th:href="@{/css/base.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${product.name} + ' - Jollibee Clone'">Product Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary-color: #e31837;
            /* Đỏ đặc trưng */
            --secondary-color: #ffc72c;
            /* Vàng đặc trưng */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Image Gallery */
        .product-img-main {
            width: 100%;
            height: 450px;
            object-fit: contain;
            background-color: #fff;
            transition: transform 0.3s ease;
        }

        .product-img-main:hover {
            transform: scale(1.05);
        }

        .thumb-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border: 2px solid transparent;
            cursor: pointer;
            transition: 0.2s;
        }

        .thumb-img:hover,
        .thumb-img.active {
            border-color: var(--primary-color);
            opacity: 0.8;
        }

        /* Price & Details */
        .product-price {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 800;
        }

        .category-badge {
            background-color: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
            padding: 5px 15px;
            border-radius: 50px;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        /* Quantity Input */
        .quantity-group {
            width: 130px;
        }

        .quantity-input {
            text-align: center;
            border-left: 0;
            border-right: 0;
        }

        /* Action Buttons */
        .btn-add-to-cart {
            background-color: var(--primary-color);
            border: none;
            padding: 12px 30px;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-add-cart:hover {
            background-color: #c4122d;
            box-shadow: 0 5px 15px rgba(227, 24, 55, 0.3);
        }

        .description-box {
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
            color: #555;
            line-height: 1.8;
        }
    </style>
</head>

<body class="bg-white">
    <div th:replace="~{client/layout/header}"></div>

    <div class="container mt-5 pt-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb small">
                <li class="breadcrumb-item"><a th:href="@{/}" class="text-decoration-none text-muted">Trang chủ</a></li>
                <li class="breadcrumb-item"><a th:href="@{/menu}" class="text-decoration-none text-muted">Thực đơn</a>
                </li>
                <li class="breadcrumb-item active text-dark fw-bold" th:text="${product.name}">Tên sản phẩm</li>
            </ol>
        </nav>

        <div class="row g-5">
            <div class="col-md-6">
                <div class="position-sticky" style="top: 100px;">
                    <div class="text-center border rounded-4 overflow-hidden bg-light mb-3">
                        <img th:src="@{'/images/products/' + ${product.img}}" id="mainImg" class="product-img-main"
                            alt="Product">
                    </div>

                    <div class="d-flex justify-content-center gap-2 overflow-auto pb-2">
                        <img th:src="@{'/images/products/' + ${product.img}}" class="thumb-img rounded-3 active"
                            onclick="changeImg(this)">

                        <div th:each="imgName : ${product.imgs}">
                            <img th:src="@{'/images/products/' + ${imgName}}" class="thumb-img rounded-3"
                                onclick="changeImg(this)">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="ps-lg-4">
                    <span class="category-badge mb-3 d-inline-block" th:text="${product.category.name}">DANH MỤC</span>
                    <h1 class="display-6 fw-bold text-dark mb-3" th:text="${product.name}">Gà Giòn Vui Vẻ</h1>

                    <div class="d-flex align-items-center mb-4">
                        <div class="product-price"
                            th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + ' ₫'}">50,000 ₫
                        </div>
                    </div>

                    <div class="description-box mb-5">
                        <p th:text="${product.description}">Mô tả ngắn gọn về độ giòn tan và hương vị đậm đà của sản
                            phẩm...</p>
                    </div>

                    <div th:if="${product.active}">


                        <div class="d-grid gap-2 d-md-flex">

                            <div class="product-card__action mt-3 d-flex gap-2 align-items-center">
                                <a class="btn btn-warning" style="text-decoration-line: none;"
                                    th:href="@{/checkout?id={id}(id=${product.id})}">
                                    Buy Now
                                </a>
                                <button class="btn btn-danger add-to-cart" th:data-id="${product.id}">
                                    Add To Cart
                                </button>

                                <div class="input-group quantity-selector shadow-sm" style="width: 100px;">
                                    <button class="btn btn-outline-secondary btn-minus" type="button">-</button>
                                    <input type="number" class="form-control text-center input-qty" value="1" min="1"
                                        th:id="'qty-' + ${product.id}">
                                    <button class="btn btn-outline-secondary btn-plus" type="button">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:unless="${product.active}" class="alert alert-warning border-0 rounded-4 p-4">
                        <i class="fa-solid fa-circle-info me-2"></i>
                        Sản phẩm này hiện đang tạm ngưng phục vụ. Quý khách vui lòng chọn món khác nhé!
                    </div>

                    <hr class="my-5 opacity-10">

                    <div class="small text-muted">
                        <p>Giao hàng nhanh trong 30 phút tại khu vực của bạn.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-5 pt-5">
            <h3 class="fw-bold mb-4">CÓ THỂ BẠN SẼ THÍCH</h3>
            <div class="row row-cols-2 row-cols-md-4 g-4">
            </div>
        </div>
    </div>
    <div th:replace="~{client/layout/footer}"></div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // 1. Xử lý nút Tăng/Giảm số lượng
            document.querySelectorAll('.btn-minus').forEach(btn => {
                btn.onclick = function () {
                    let input = this.parentElement.querySelector('.input-qty');
                    if (parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
                }
            });

            document.querySelectorAll('.btn-plus').forEach(btn => {
                btn.onclick = function () {
                    let input = this.parentElement.querySelector('.input-qty');
                    input.value = parseInt(input.value) + 1;
                }
            });

            // 2. Xử lý Thêm vào giỏ hàng bằng AJAX
            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.onclick = async function () {
                    const productId = this.getAttribute('data-id');
                    const quantity = document.getElementById('qty-' + productId).value;

                    const cartDTO = {
                        productId: parseInt(productId),
                        quantity: parseInt(quantity)
                    };

                    try {
                        const response = await fetch('/cart/add', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]')?.getAttribute('content') || ''
                            },
                            body: JSON.stringify(cartDTO)
                        });

                        if (response.ok) {
                            Swal.fire({
                                tilte: 'Success',
                                text: 'Add to cart success',
                                icon: 'success',
                                showClass: {
                                    popup: 'animate__animated animate__fadeInDown'
                                },
                                hideClass: {
                                    popup: 'animate__animated animate__fadeOutUp'
                                }
                            })
                            // alert('Đã thêm món ăn vào giỏ hàng!');
                            // Cập nhật số lượng trên icon giỏ hàng ở Header nếu có
                        } else if (response.status === 403) {
                            alert('Vui lòng đăng nhập với tài khoản khách hàng!');
                        } else {
                            alert('Có lỗi xảy ra, vui lòng thử lại.');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Không thể kết nối đến máy chủ!');
                    }
                };
            });
        });
        // Đổi ảnh chính khi nhấn vào ảnh nhỏ
        function changeImg(element) {
            document.getElementById('mainImg').src = element.src;
            document.querySelectorAll('.thumb-img').forEach(img => img.classList.remove('active'));
            element.classList.add('active');
        }

        // Cập nhật số lượng
        function updateQty(step) {
            const input = document.getElementById('qtyInput');
            let currentVal = parseInt(input.value);
            if (!isNaN(currentVal)) {
                let newVal = currentVal + step;
                if (newVal >= 1) input.value = newVal;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>