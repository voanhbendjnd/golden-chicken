<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Management</title>
    <link rel="shortcut icon" th:href="@{/img/favicon_New.png}" type="image/x-icon">
    <link th:href="@{/css/base.css}" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <th:block th:replace="~{common/head}"></th:block>
    <link th:href="@{/css/profileTest.css}" rel="stylesheet">
</head>

<body>
    <div th:replace="~{client/layout/header}"></div>
    <div class="page">
        <aside class="sidebar">
            <h3>My Account</h3>
            <nav class="nav">
                <a class="active" href="#">Account Management</a>
                <a href="#">My Orders</a>
                <a href="#">Address Book</a>
                <a href="#">Account Information</a>
                <a href="#">Voucher List</a>
            </nav>
        </aside>

        <main class="main">
            <h1 class="title">Account Management</h1>

            <p class="subtitle">
                Hi <span th:text="${profile.fullName}">User</span>. With this page, you will be able to manage all your
                account information.
            </p>
            <form th:action="@{/profile/avatar}" method="post" enctype="multipart/form-data" id="avatarForm">
                <section class="section">
                    <div class="section__header">AVATAR</div>
            
                    <div class="section__body grid-2">
                        <div class="col avatar-col">
                            <img id="avatarPreview"
                                 th:src="${profile.avatar != null}
                                          ? @{/img/avatar/{file}(file=${profile.avatar})}
                                          : @{/img/testavt.jpg}"
                                 alt="Avatar"
                                 class="avatar-img">
                        </div>
            
                        <div>
                            <h4 class="block-title">Thay đổi ảnh đại diện</h4>
                            <p>Ảnh sẽ hiển thị trên hồ sơ và đơn hàng của bạn.</p>
            
                            <label class="btn-upload" for="avatarFile">
                                Chọn ảnh mới
                                <input type="file" name="avatarFile" id="avatarFile" hidden accept=".png,.jpg,.jpeg">
                            </label>
                        </div>
                    </div>
                </section>
            </form>


            <section class="section">
                <div class="section__header">Account Information</div>
                <div class="section__body grid-2">
                    <div class="col">
                        <h4 class="block-title">Contact Information</h4>
                        <p><strong th:text="${profile.fullName}">User</strong></p>
                        <p th:text="${profile.email}">email@example.com</p>
                        <p th:text="${profile.phone}">0123456789</p>
                        <div class="actions">
                            <a th:if="${!isEdit}" th:href="@{/profile(edit=true)}" class="btn btn-warning">Edit</a>
                        </div>
                    </div>

                    <div id="updateProfileBox" th:if="${isEdit}">
                        <h4 class="block-title">Update Profile</h4>
                        <form th:action="@{/profile}" th:object="${profileForm}" method="post" class="mt-2">

                            <div class="mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" th:field="*{fullName}" class="form-control"
                                    th:disabled="${!isEdit}" />
                                <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('fullName')}"
                                    th:errors="*{fullName}"></div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Phone</label>
                                <input type="text" th:field="*{phone}" class="form-control" placeholder="10-15 digits"
                                    th:disabled="${!isEdit}" />
                                <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('phone')}"
                                    th:errors="*{phone}"></div>
                            </div>

                            <div class="actions d-flex gap-2">
                                <button th:if="${isEdit}" class="btn btn-success" type="submit"
                                    style="width: 12%; margin-right: 10px;">Save</button>
                                <a th:if="${isEdit}" th:href="@{/profile}" class="btn btn-outline-danger">Cancel</a>
                            </div>
                        </form>
                    </div>


                </div>
            </section>

            <section class="section">
                <div class="section__header between">
                    <span>Address Book</span>
                    <a th:href="@{/addresses}">Manage Addresses</a>
                </div>
                <div class="section__body">
                    <h4 class="block-title">Default Shipping Address</h4>

                    <div th:if="${defaultAddress != null}">
                        <p><strong th:text="${defaultAddress.recipientName}">Full name</strong></p>
                        <p>
                            <span th:text="${defaultAddress.specificAddress}">Specific address</span>,
                            <span th:text="${defaultAddress.ward}">Ward</span>,
                            <span th:text="${defaultAddress.district}">District</span>,
                            <span th:text="${defaultAddress.city}">Cần Thơ</span>
                        </p>
                        <p>T: <span th:text="${defaultAddress.recipientPhone}">Phone</span></p>
                    </div>

                    <div th:if="${defaultAddress == null}">
                        <p>Chưa có địa chỉ mặc định.</p>
                    </div>

                    <div class="actions">
                        <a th:href="@{/addresses}">Quản lý địa chỉ</a>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section__header">Recent Orders</div>
                <div class="section__body">
                    <div class="note">
                        <span class="icon">!</span>
                        <span>You have placed no orders.</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div th:replace="~{client/layout/footer}"></div>
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/app.js}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const avatarFile = document.getElementById("avatarFile");
            const avatarForm = document.getElementById("avatarForm");
            const avatarPreview = document.getElementById("avatarPreview");

            if (!avatarFile || !avatarForm || !avatarPreview) {
                return;
            }

            avatarFile.addEventListener("change", function (e) {
                const file = e.target.files && e.target.files[0];
                if (!file) {
                    return;
                }

                const imgURL = URL.createObjectURL(file);
                avatarPreview.src = imgURL;
                avatarForm.submit();
            });
        });
    </script>
</body>

</html>
