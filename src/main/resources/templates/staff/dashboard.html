<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <head th:replace="~{common/head}"></head>
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <!-- <script th:src="@{/js/dashboard.js}"></script> -->


    <title>Dashboard</title>
</head>

<body>
    <div th:replace="~{component/header}"></div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3 col-lg-2 p-0">
                <div th:replace="~{staff/layout/sidebar}"></div>
            </div>
            <main class="col-md-9 col-lg-10 ms-sm-auto px-md-4">
                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
                    rel="stylesheet">
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                <div class="container py-4">
                    <h1 class="text-center mb-4">Data Visualization Dashboard</h1>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="dashboard-card weather-widget">
                                <div class="weather-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="weather-temp">25°C</div>
                                <div class="weather-description">Sunny</div>
                                <div class="weather-location">New York, NY</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>Quick Stats</h3>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="stat-card">
                                            <div class="stat-icon text-primary">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div class="stat-value" th:text="${cntUser}">1,234</div>
                                            <div class="stat-label">Total Users</div>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="stat-card">
                                            <div class="stat-icon text-success">
                                                <i class="fas fa-shopping-cart"></i>
                                            </div>
                                            <div class="stat-value" th:text="${cntOrder}">$5,678</div>
                                            <div class="stat-label">Revenue</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <div class="stat-icon text-info">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                            <div class="stat-value">42</div>
                                            <div class="stat-label">New Posts</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <div class="stat-icon text-warning">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <div class="stat-value">4.7</div>
                                            <div class="stat-label">Avg. Rating</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="dashboard-card">
                                <h3>Monthly Revenue</h3>
                                <canvas id="revenueChart"></canvas>
                            </div>
                            <div class="dashboard-card">
                                <h3>User Demographics</h3>
                                <canvas id="demographicsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
            // 1. Kiểm tra dữ liệu từ Server
            const rawData = /*[[${chartData}]]*/[];
            if (!rawData || rawData.length === 0) {
                console.warn("No chart data available");
                return;
            }

            // 2. Tách dữ liệu
            const labels = rawData.map(item => item.month);
            const revenueValues = rawData.map(item => item.revenue);

            // 3. Khởi tạo biểu đồ Revenue
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Doanh thu (VNĐ)',
                        data: revenueValues,
                        borderColor: '#4bc0c0',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        fill: true,
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#4bc0c0'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Giúp biểu đồ co giãn tốt hơn trong card
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => value.toLocaleString('vi-VN') + ' ₫'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => `Doanh thu: ${context.parsed.y.toLocaleString('vi-VN')} ₫`
                            }
                        }
                    }
                }
            });

            // 4. (Gợi ý) Khởi tạo Demographics Chart nếu bạn có dữ liệu
            // Nếu chưa có, hãy tạm thời xóa thẻ canvas id="demographicsChart" ở trên đi.
        });
    </script>
</body>

</html>